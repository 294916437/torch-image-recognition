准备训练数据和模型...
开始训练模型...

=== 训练开始于 16:45:56 ===
使用 MobileNetV3 Small 模型 + 标准训练 + 批量大小 96
共 30 轮训练，每轮有 2675 个训练批次和 105 个验证批次

[Epoch 1/30]========================================

[训练阶段]
批次: [2675/2675] 损失: 2.7903 准确率: 110.99% 速度: 63.7 样本/秒
训练阶段 完成 - 损失: 1.8314, 准确率: 0.7285

[验证阶段]
批次: [105/105] 损失: 8.0540 准确率: 520.65% 速度: 64.0 样本/秒
验证阶段 完成 - 损失: 1.3531, 准确率: 0.8747
✅ 新的最佳验证准确率: 0.8747
💾 模型已保存到: medicine_best_model.pth
📊 当前学习率: 0.000195
⏱️ 本轮用时: 448.2 秒
总进度: 3.3% [1/30]

[Epoch 2/30]========================================
预计完成时间: 20:30:02 (剩余约 216.6 分钟)

[训练阶段]
批次: [2675/2675] 损失: 2.2064 准确率: 128.94% 速度: 788.5 样本/秒
训练阶段 完成 - 损失: 1.4481, 准确率: 0.8463

[验证阶段]
批次: [105/105] 损失: 7.1629 准确率: 550.48% 速度: 1017.7 样本/秒
验证阶段 完成 - 损失: 1.2034, 准确率: 0.9248
✅ 新的最佳验证准确率: 0.9248
💾 模型已保存到: medicine_best_model.pth
📊 当前学习率: 0.000181
⏱️ 本轮用时: 439.0 秒
总进度: 6.7% [2/30]

[Epoch 3/30]========================================
预计完成时间: 20:27:44 (剩余约 207.0 分钟)

[训练阶段]
批次: [2675/2675] 损失: 2.0425 准确率: 134.42% 速度: 765.9 样本/秒
训练阶段 完成 - 损失: 1.3405, 准确率: 0.8822

[验证阶段]
批次: [105/105] 损失: 6.7321 准确率: 563.51% 速度: 1600000.0 样本/秒
验证阶段 完成 - 损失: 1.1310, 准确率: 0.9467
✅ 新的最佳验证准确率: 0.9467
💾 模型已保存到: medicine_best_model.pth
📊 当前学习率: 0.000159
⏱️ 本轮用时: 431.1 秒
总进度: 10.0% [3/30]

[Epoch 4/30]========================================
预计完成时间: 20:25:40 (剩余约 197.8 分钟)

[训练阶段]
批次: [2675/2675] 损失: 1.9289 准确率: 138.07% 速度: 828.0 样本/秒
训练阶段 完成 - 损失: 1.2660, 准确率: 0.9062

[验证阶段]
批次: [105/105] 损失: 6.4815 准确率: 569.82% 速度: 1002.9 样本/秒
验证阶段 完成 - 损失: 1.0889, 准确率: 0.9573
✅ 新的最佳验证准确率: 0.9573
💾 模型已保存到: medicine_best_model.pth
📊 当前学习率: 0.000131
⏱️ 本轮用时: 419.2 秒
总进度: 13.3% [4/30]

[Epoch 5/30]========================================
预计完成时间: 20:23:08 (剩余约 188.2 分钟)

[训练阶段]
批次: [2675/2675] 损失: 1.8475 准确率: 140.59% 速度: 894.2 样本/秒
训练阶段 完成 - 损失: 1.2126, 准确率: 0.9227

[验证阶段]
批次: [105/105] 损失: 6.1894 准确率: 575.95% 速度: 1600000.0 样本/秒
验证阶段 完成 - 损失: 1.0398, 准确率: 0.9676
✅ 新的最佳验证准确率: 0.9676
💾 模型已保存到: medicine_best_model.pth
📊 当前学习率: 0.000101
⏱️ 本轮用时: 413.7 秒
总进度: 16.7% [5/30]

[Epoch 6/30]========================================
预计完成时间: 20:21:04 (剩余约 179.3 分钟)

[训练阶段]
批次: [2675/2675] 损失: 1.7775 准确率: 142.41% 速度: 890.3 样本/秒
训练阶段 完成 - 损失: 1.1666, 准确率: 0.9347

[验证阶段]
批次: [105/105] 损失: 5.9805 准确率: 581.96% 速度: 1023.6 样本/秒
验证阶段 完成 - 损失: 1.0047, 准确率: 0.9777
✅ 新的最佳验证准确率: 0.9777
💾 模型已保存到: medicine_best_model.pth
📊 当前学习率: 0.000070
⏱️ 本轮用时: 408.0 秒
总进度: 20.0% [6/30]

验证阶段 完成 - 损失: 1.0047, 准确率: 0.9777
✅ 新的最佳验证准确率: 0.9777
💾 模型已保存到: medicine_best_model.pth
📊 当前学习率: 0.000070
⏱️ 本轮用时: 408.0 秒
总进度: 20.0% [6/30]

✅ 新的最佳验证准确率: 0.9777
💾 模型已保存到: medicine_best_model.pth
📊 当前学习率: 0.000070
⏱️ 本轮用时: 408.0 秒
总进度: 20.0% [6/30]

📊 当前学习率: 0.000070
⏱️ 本轮用时: 408.0 秒
总进度: 20.0% [6/30]

[Epoch 7/30]========================================
⏱️ 本轮用时: 408.0 秒
总进度: 20.0% [6/30]

[Epoch 7/30]========================================
总进度: 20.0% [6/30]

[Epoch 7/30]========================================
[Epoch 7/30]========================================
预计完成时间: 20:19:13 (剩余约 170.6 分钟)

[训练阶段]
批次: [2675/2675] 损失: 1.7220 准确率: 143.90% 速度: 779.0 样本/秒
训练阶段 完成 - 损失: 1.1302, 准确率: 0.9445

[验证阶段]
批次: [105/105] 损失: 5.8618 准确率: 583.21% 速度: 1024.9 样本/秒
验证阶段 完成 - 损失: 0.9848, 准确率: 0.9798
✅ 新的最佳验证准确率: 0.9798
💾 模型已保存到: medicine_best_model.pth
📊 当前学习率: 0.000042
⏱️ 本轮用时: 407.3 秒
总进度: 23.3% [7/30]

[Epoch 8/30]========================================
预计完成时间: 20:17:50 (剩余约 162.5 分钟)

[训练阶段]
批次: [2675/2675] 损失: 1.6789 准确率: 144.98% 速度: 786.2 样本/秒
训练阶段 完成 - 损失: 1.1019, 准确率: 0.9516

[验证阶段]
批次: [105/105] 损失: 5.7173 准确率: 585.71% 速度: 748.6 样本/秒
验证阶段 完成 - 损失: 0.9605, 准确率: 0.9840
✅ 新的最佳验证准确率: 0.9840
💾 模型已保存到: medicine_best_model.pth
📊 当前学习率: 0.000020
⏱️ 本轮用时: 411.8 秒
总进度: 26.7% [8/30]

[Epoch 9/30]========================================
预计完成时间: 20:17:06 (剩余约 154.8 分钟)

[训练阶段]
批次: [2675/2675] 损失: 1.6501 准确率: 145.68% 速度: 894.1 样本/秒
训练阶段 完成 - 损失: 1.0830, 准确率: 0.9561

[验证阶段]
批次: [105/105] 损失: 5.6708 准确率: 586.49% 速度: 1600000.0 样本/秒
验证阶段 完成 - 损失: 0.9527, 准确率: 0.9853
✅ 新的最佳验证准确率: 0.9853
💾 模型已保存到: medicine_best_model.pth
📊 当前学习率: 0.000006
⏱️ 本轮用时: 403.4 秒
总进度: 30.0% [9/30]

[Epoch 10/30]========================================
预计完成时间: 20:16:03 (剩余约 147.1 分钟)

[训练阶段]
批次: [2675/2675] 损失: 1.6378 准确率: 145.94% 速度: 780.1 样本/秒
训练阶段 完成 - 损失: 1.0749, 准确率: 0.9578

[验证阶段]
批次: [105/105] 损失: 5.6372 准确率: 586.73% 速度: 1021.6 样本/秒
验证阶段 完成 - 损失: 0.9470, 准确率: 0.9857
✅ 新的最佳验证准确率: 0.9857
💾 模型已保存到: medicine_best_model.pth
📊 当前学习率: 0.000200
⏱️ 本轮用时: 390.5 秒
总进度: 33.3% [10/30]

[Epoch 11/30]========================================
预计完成时间: 20:14:33 (剩余约 139.1 分钟)

[训练阶段]
批次: [2675/2675] 损失: 1.8337 准确率: 140.92% 速度: 900.3 样本/秒
训练阶段 完成 - 损失: 1.2035, 准确率: 0.9249

[验证阶段]
批次: [105/105] 损失: 6.3036 准确率: 574.88% 速度: 1600000.0 样本/秒
验证阶段 完成 - 损失: 1.0590, 准确率: 0.9658
⚠️ 连续 1/7 轮未改善
📊 当前学习率: 0.000199
⏱️ 本轮用时: 399.0 秒
总进度: 36.7% [11/30]

[Epoch 12/30]========================================
预计完成时间: 20:13:44 (剩余约 131.6 分钟)

[训练阶段]
批次: [2675/2675] 损失: 1.8292 准确率: 141.27% 速度: 787.7 样本/秒
训练阶段 完成 - 损失: 1.2005, 准确率: 0.9272

[验证阶段]
批次: [105/105] 损失: 6.2265 准确率: 576.43% 速度: 1030.1 样本/秒
验证阶段 完成 - 损失: 1.0461, 准确率: 0.9684
⚠️ 连续 2/7 轮未改善
📊 当前学习率: 0.000195
⏱️ 本轮用时: 399.5 秒
总进度: 40.0% [12/30]

[Epoch 13/30]========================================
预计完成时间: 20:13:03 (剩余约 124.3 分钟)

[训练阶段]
批次: [2675/2675] 损失: 1.8108 准确率: 141.67% 速度: 787.7 样本/秒
训练阶段 完成 - 损失: 1.1885, 准确率: 0.9298

[验证阶段]
批次: [105/105] 损失: 6.1240 准确率: 579.70% 速度: 3150.1 样本/秒
验证阶段 完成 - 损失: 1.0288, 准确率: 0.9739
⚠️ 连续 3/7 轮未改善
📊 当前学习率: 0.000189
⏱️ 本轮用时: 394.3 秒
总进度: 43.3% [13/30]

[Epoch 14/30]========================================
预计完成时间: 20:12:17 (剩余约 116.9 分钟)

[训练阶段]
批次: [2675/2675] 损失: 1.7848 准确率: 142.48% 速度: 788.6 样本/秒
训练阶段 完成 - 损失: 1.1714, 准确率: 0.9352

[验证阶段]
批次: [105/105] 损失: 6.0564 准确率: 580.36% 速度: 1600000.0 样本/秒
验证阶段 完成 - 损失: 1.0175, 准确率: 0.9750
⚠️ 连续 4/7 轮未改善
📊 当前学习率: 0.000181
⏱️ 本轮用时: 399.8 秒
总进度: 46.7% [14/30]

[Epoch 15/30]========================================
预计完成时间: 20:11:50 (剩余约 109.8 分钟)

[训练阶段]
批次: [2675/2675] 损失: 1.7608 准确率: 143.04% 速度: 893.6 样本/秒
训练阶段 完成 - 损失: 1.1557, 准确率: 0.9388

[验证阶段]
批次: [105/105] 损失: 6.0389 准确率: 581.90% 速度: 1021.6 样本/秒
验证阶段 完成 - 损失: 1.0145, 准确率: 0.9776
⚠️ 连续 5/7 轮未改善
📊 当前学习率: 0.000171
⏱️ 本轮用时: 394.3 秒
总进度: 50.0% [15/30]

[Epoch 16/30]========================================
预计完成时间: 20:11:15 (剩余约 102.7 分钟)

[训练阶段]
批次: [2675/2675] 损失: 1.7369 准确率: 143.74% 速度: 895.3 样本/秒
训练阶段 完成 - 损失: 1.1400, 准确率: 0.9434

[验证阶段]
批次: [105/105] 损失: 5.9045 准确率: 583.45% 速度: 1023.7 样本/秒
验证阶段 完成 - 损失: 0.9920, 准确率: 0.9802
⚠️ 连续 6/7 轮未改善
📊 当前学习率: 0.000159
⏱️ 本轮用时: 467.1 秒
总进度: 53.3% [16/30]

[Epoch 17/30]========================================
预计完成时间: 20:13:01 (剩余约 96.6 分钟)

[训练阶段]
批次: [2675/2675] 损失: 1.7108 准确率: 144.30% 速度: 787.8 样本/秒
训练阶段 完成 - 损失: 1.1229, 准确率: 0.9471

[验证阶段]
批次: [105/105] 损失: 5.8652 准确率: 584.52% 速度: 1019.2 样本/秒
验证阶段 完成 - 损失: 0.9854, 准确率: 0.9820
⚠️ 连续 7/7 轮未改善

🛑 触发早停机制
最佳验证准确率: 0.9857

💾 最终模型已保存到: medicine_final_model.pth

开始评估模型...
评估中... 共 105 批次
评估进度: |██████████████████████████████| 100.0% - 批次 105/105 - 当前准确率: 98.57%

🎯 测试集上的总体准确率: 98.57%

## 📊 各类别准确率:

## 类别 准确率 样本数

【最佳 10 个类别】
三七 100.00% 65.0
丹参 100.00% 60.0
乌梅 100.00% 63.0
五味子 100.00% 61.0
人参切片 100.00% 70.0
仙鹤草 100.00% 52.0
何首乌 100.00% 69.0
佛手 100.00% 58.0
僵蚕 100.00% 68.0
全蝎 100.00% 60.0

【最差 10 个类别】
牡蛎 96.43% 56.0
前胡 96.30% 54.0
石膏 96.23% 53.0
附子 95.59% 68.0
木香 95.52% 67.0
大血藤 95.08% 61.0
天冬 93.94% 66.0
枳实 92.86% 70.0
谷芽 48.28% 58.0
麦芽 44.93% 69.0

---

✅ 训练和评估完成!
